<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"> <head> <script async src="https://www.googletagmanager.com/gtag/js?id=G-3N6CESJ0B5"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-3N6CESJ0B5");</script> <link href="http://gmpg.org/xfn/11" rel="profile"> <meta http-equiv="content-type" content="text/html; charset=utf-8"> <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"> <link rel="manifest" href="/site.webmanifest"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"> <title> Hooks in AngularJS Controllers &middot; effluence </title> <link rel="stylesheet" href="/assets/css/styles.css"> <link rel="preconnect" href="https://fonts.gstatic.com"> <link href="https://fonts.googleapis.com/css2?family=Epilogue&display=swap" rel="stylesheet"> <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"> <link rel="canonical" href="https://sonnym.com/2014/02/05/hooks-in-angularjs-controllers/"> </head> <body class="layout-reverse"> <div class="sidebar"> <div class="container sidebar-sticky"> <div class="sidebar-about"> <h1>effluence</h1> <p class="lead"></p> </div> <ul class="sidebar-nav"> <li class="sidebar-nav-item"> <a href="/">home</a> </li> <li class="sidebar-nav-item"> <a href="/about/">about</a> </li> <li class="sidebar-nav-item"> <a href="/atom.xml" target="_blank">rss</a> </li> </ul> <p>&copy; 2026. All rights reserved.</p> </div> </div> <div class="content container"> <div class="post"> <h1 class="post-title">Hooks in AngularJS Controllers</h1> <h2 id="the-situation">The Situation</h2> <p>Sometimes when working with nested scopes, you may encounter a situation in which some scope action depends on the status of some arbitrarily nested controller. This could be a multi-part form built from reusable components, preventing the user from proceeding until complete, for example.</p> <p>An architecture that allows scopes nested within another scope to influence the life cycle of the latter has one primary advantage, namely, greater separation of concerns. A nested controller can supply functions for data validation and formatting, while the parent controller defines functions for navigation and accumulation of results. This leads to better modularity, as the parent controller is isolated from the implementation of nested controllers, while the latter are able to be used modularly in more contexts.</p> <h2 id="a-simple-example">A Simple Example</h2> <p><span class="fancylink"> <a href="http://plnkr.co/edit/QKzZZq?p=preview">Open in Plunkr</a> <span> <a href="http://plnkr.co/edit/QKzZZq?p=preview" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span></p> <p>As the structure of the following example indicates, we have three controllers</p> <ul> <li>one that coordinates and two that handle user input. We have taken the liberty of using <span class="fancylink"> <a href="http://underscorejs.org/">underscore</a> <span> <a href="http://underscorejs.org/" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span> to simplify checking if all conditions are met.</li> </ul> <p>Here, the <code class="language-plaintext highlighter-rouge">FormCheckboxCtrl</code> has no validation, but does coerce its results to be human readable, while <code class="language-plaintext highlighter-rouge">FormTextInputCtrl</code> returns the text input and is invalid if none is provided.</p> <p>What remains is, simply, to make it work.</p> <figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;body</span> <span class="na">ng-app=</span><span class="s">"HookExample"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">ng-controller=</span><span class="s">"FormPageCtrl"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>Please enter some text below.<span class="nt">&lt;/p&gt;</span>

    <span class="nt">&lt;span</span> <span class="na">ng-controller=</span><span class="s">"FormCheckboxCtrl"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">ng-model=</span><span class="s">"checkbox"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/span&gt;</span>

    <span class="nt">&lt;span</span> <span class="na">ng-controller=</span><span class="s">"FormTextInputCtrl"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">ng-model=</span><span class="s">"textInput"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/span&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">ng-show=</span><span class="s">"showResults()"</span><span class="nt">&gt;</span>{{ $scope.results() }}<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span></code></pre></figure> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">HookExample</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nf">module</span><span class="p">(</span><span class="dl">"</span><span class="s2">HookExample</span><span class="dl">"</span><span class="p">,</span> <span class="p">[]);</span>

<span class="nx">HookExample</span><span class="p">.</span><span class="nf">controller</span><span class="p">(</span><span class="dl">"</span><span class="s2">FormPageCtrl</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">RegisterHook</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">showResults</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">RegisterHook</span><span class="p">(</span><span class="dl">"</span><span class="s2">isDataValid</span><span class="dl">"</span><span class="p">,</span> <span class="nx">$scope</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">every</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">$scope</span><span class="p">.</span><span class="nx">results</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">RegisterHook</span><span class="p">(</span><span class="dl">"</span><span class="s2">getResults</span><span class="dl">"</span><span class="p">,</span> <span class="nx">$scope</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">results</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="dl">"</span><span class="s2"> - </span><span class="dl">"</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">};</span>
<span class="p">});</span>

<span class="nx">HookExample</span><span class="p">.</span><span class="nf">controller</span><span class="p">(</span><span class="dl">"</span><span class="s2">FormTextInputCtrl</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">isDataValid</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">textInput</span> <span class="o">&amp;&amp;</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">textInput</span> <span class="o">!==</span> <span class="dl">""</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">$scope</span><span class="p">.</span><span class="nx">getResults</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">textInput</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">});</span>

<span class="nx">HookExample</span><span class="p">.</span><span class="nf">controller</span><span class="p">(</span><span class="dl">"</span><span class="s2">FormCheckboxCtrl</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">getResults</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">checkbox</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">Yes</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">No</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">});</span></code></pre></figure> <h2 id="a-hook-implementation">A Hook Implementation</h2> <p>By recursively traversing the <code class="language-plaintext highlighter-rouge">$$childHead</code> and <code class="language-plaintext highlighter-rouge">$$nextSibling</code> properties of the scope, we can give ask if any controller nested within the hierarchy wishes to respond to the hook, thereby influencing the life cycle of our parent controller.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">HookExample</span><span class="p">.</span><span class="nf">factory</span><span class="p">(</span><span class="dl">"</span><span class="s2">RegisterHook</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">scope</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="p">(</span><span class="kd">function</span> <span class="nf">traverse</span><span class="p">(</span><span class="nx">scope</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">scope</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if </span><span class="p">(</span><span class="nx">_</span><span class="p">.(</span><span class="nx">scope</span><span class="p">,</span> <span class="nx">name</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">results</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">scope</span><span class="p">[</span><span class="nx">name</span><span class="p">]());</span>
      <span class="p">}</span>

      <span class="nf">traverse</span><span class="p">(</span><span class="nx">scope</span><span class="p">.</span><span class="nx">$$childHead</span><span class="p">);</span>
      <span class="nf">traverse</span><span class="p">(</span><span class="nx">scope</span><span class="p">.</span><span class="nx">$$nextSibling</span><span class="p">);</span>
    <span class="p">})(</span><span class="nx">scope</span><span class="p">.</span><span class="nx">$$childHead</span><span class="p">);</span>

    <span class="k">return</span> <span class="nf">callback</span><span class="p">(</span><span class="nx">results</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure> <p>This simple implemnation will look for and call the <code class="language-plaintext highlighter-rouge">name</code> function on any scope, starting from the <code class="language-plaintext highlighter-rouge">$$childHead</code> of the scope passed in. Once all the results have been accumulated, the <code class="language-plaintext highlighter-rouge">callback</code> is called with those results, allowing for a nice functional interface, as in the case of passing in <code class="language-plaintext highlighter-rouge">_.every</code>.</p> <p>Since the callback is required in this naive implementation, it would be possible to pass in <code class="language-plaintext highlighter-rouge">angular.noop</code> as the callback to discard the results, thereby issuing some call to arbitrarily nested controllers. In that case, however, a more reasonable approach would be to <code class="language-plaintext highlighter-rouge">$broadcast</code> an event.</p> <h2 id="hooks-vs-events-vs-services">Hooks vs. Events vs. Services</h2> <p>When is this approach of registering hooks more appropriate than using events? Primarily when you need to get the data back from the user via collaborating controllers. The way event broadcasting requires an event to the child controllers, each of which must call another event for the parent controller to handle quickly becomes brittle. In cases where the data is not transient, it is likely best to use a service object to store all the data and have the collaborators reference it directly.</p> <p>That said, there is certainly still a place for hooks like the one outlined above, but it is necessary to use it in appropriate situations. Littering our code with hooks that would be best treated as services for their persistence or events for their unidirectionality will not be an improvement.</p> <p>But in cases where data transience and bidirectional collaboration between controllers at different levels of nesting is present, hooks reign supreme by exposing carefully selected points of interaction.</p> <h2 id="improvements">Improvements</h2> <p>Herein, we have only examined a very simple hooking mechanism, which can certainly be built out to have some additional interesting properties. Optional callbacks and the ability to handle arguments would be straight forward changes. More interesting is the possibility to return more than just a single function for accumulating results, but instead having a more robust interface. This could include functionality akin to that in <code class="language-plaintext highlighter-rouge">ActiveRecord</code> callbacks, wherein returning false prevents future hooks from running and prevents some default action.</p> <span class="post-date">05 Feb 2014</span> </div> <div class="related"> <h2>Related Posts</h2> <ul class="related-posts"> <li> <h3> <a href="/2017/06/18/on-maintainability-gold-plating-the-game-of-life-in-elm/"> On Maintainability: Gold Plating the Game of Life in Elm <small>18 Jun 2017</small> </a> </h3> </li> <li> <h3> <a href="/2017/06/05/common-table-expressions-in-activerecord-a-case-study-of-quantiles/"> Common Table Expressions in ActiveRecord: A Case Study of Quantiles <small>05 Jun 2017</small> </a> </h3> </li> <li> <h3> <a href="/2018/01/03/privacy-and-exposure-gatekeeprs-and-privileged-consumers/"> Privacy and Exposure, Gatekeepers and Privileged Consumers <small>03 Jan 2018</small> </a> </h3> </li> </ul> </div> <p class="bitcoin"></p> </div> </body> </html>