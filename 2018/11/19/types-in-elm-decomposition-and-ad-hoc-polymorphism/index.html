<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"> <head> <script async src="https://www.googletagmanager.com/gtag/js?id=G-3N6CESJ0B5"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-3N6CESJ0B5");</script> <link href="http://gmpg.org/xfn/11" rel="profile"> <meta http-equiv="content-type" content="text/html; charset=utf-8"> <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"> <link rel="manifest" href="/site.webmanifest"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"> <title> Types in Elm: Decomposition and Ad Hoc Polymorphism &middot; effluence </title> <link rel="stylesheet" href="/assets/css/styles.css"> <link rel="preconnect" href="https://fonts.gstatic.com"> <link href="https://fonts.googleapis.com/css2?family=Epilogue&display=swap" rel="stylesheet"> <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"> <link rel="canonical" href="https://sonnym.com/2018/11/19/types-in-elm-decomposition-and-ad-hoc-polymorphism/"> </head> <body class="layout-reverse"> <div class="sidebar"> <div class="container sidebar-sticky"> <div class="sidebar-about"> <h1>effluence</h1> <p class="lead"></p> </div> <ul class="sidebar-nav"> <li class="sidebar-nav-item"> <a href="/">home</a> </li> <li class="sidebar-nav-item"> <a href="/about/">about</a> </li> <li class="sidebar-nav-item"> <a href="/atom.xml" target="_blank">rss</a> </li> </ul> <p>&copy; 2026. All rights reserved.</p> </div> </div> <div class="content container"> <div class="post"> <h1 class="post-title">Types in Elm: Decomposition and Ad Hoc Polymorphism</h1> <h2 id="new-beginnings">New Beginnings</h2> <p>Since I originally learned about and tried Elm in 2013, a lot about the language has changed. Elm and I have grown distant and close several times over the years, each encounter being more pleasant than the last, but always ending somewhat abruptly and falling a bit short. After our most recent reunion, however, I feel as though the language has matured to a point where I am empowered to really move forward with the larger projects I began several years ago.</p> <p>The purpose of this article is to elucidate some topics that were not abundantly clear to me as an effectively new Elm user. It builds from real problems I have encountered while writing real programs, and the solutions I devised to address those issues. These techniques revolve around how we compose and decompose types to make our programs more maintainable.</p> <p>before we move forward with the specifics, I would like to take a detour through my history with Elm as a way to frame the present discussion.</p> <h2 id="experience-thus-far">Experience Thus Far</h2> <p>My first foray into <span class="fancylink"> <a href="http://elm-lang.org/">Elm</a> <span> <a href="http://elm-lang.org/" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span> was in December of 2013, when I wrote a toy program during <span class="fancylink"> <a href="http://ludumdare.com/compo/ludum-dare-28/">Ludum Dare 28</a> <span> <a href="http://ludumdare.com/compo/ludum-dare-28/" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span>. Since that time, I have always admired the language and enjoyed <span class="fancylink"> <a href="/2017/05/22/revisiting-the-game-of-life-in-elm/">returning</a> <span> <a href="/2017/05/22/revisiting-the-game-of-life-in-elm/" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span> to to it whenever I could, although that has only been to a <span class="fancylink"> <a href="/2017/06/18/on-maintainability-gold-plating-the-game-of-life-in-elm/">limited extent</a> <span> <a href="/2017/06/18/on-maintainability-gold-plating-the-game-of-life-in-elm/" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span>. During the past few years, the language has been heavily refined and the focus has shifted from being heavily graphical and canvas-oriented to competing with the other mainstream frameworks. Elm now shares some core features with those frameworks that make it excellent for web application development, for instance making use of a <span class="fancylink"> <a href="https://package.elm-lang.org/packages/elm/virtual-dom/latest/">virtual DOM</a> <span> <a href="https://package.elm-lang.org/packages/elm/virtual-dom/latest/" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span> implementation for efficiently handling state updates.</p> <p>Elm, however, also comes with other advantages that JavaScript frameworks are incapable of offering. They type system provides both an unparalleled level of safety, but also allows for dead code elimination that far surpasses anything feasible in a highly dynamic language like JavaScript. The release of <span class="fancylink"> <a href="http://elm-lang.org/blog/small-assets-without-the-headache">0.19</a> <span> <a href="http://elm-lang.org/blog/small-assets-without-the-headache" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span> earlier this year has brought me back to the language after an extended hiatus, and the experience thus far has be extremely pleasant.</p> <p>The last time I spent any significant time with Elm, I was able to make progress on some projects of reasonable complexity, but ultimately hit a wall where the future direction of my programs started to become unclear. This was during the time when signals were the underlying principle, through when <span class="fancylink"> <a href="https://elm-lang.org/blog/announce/0.15">mailboxes</a> <span> <a href="https://elm-lang.org/blog/announce/0.15" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span> and addresses allowed us to create our own effects. In retrospect, the most concise explanation I can now give of the problems I encountered at the time were all related with having to managing my own effects. Maintaining a series of reusable actions that could be triggered in different ways, and how to properly factor an application quickly became insurmountable hurdles.</p> <p>During those intervening versions, however, Elm <span class="fancylink"> <a href="http://elm-lang.org/blog/farewell-to-frp">moved on</a> <span> <a href="http://elm-lang.org/blog/farewell-to-frp" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span> from a functional reactive programming paradigm and, perhaps even more importantly, added a runtime that <span class="fancylink"> <a href="https://package.elm-lang.org/packages/elm/core/latest/Platform-Cmd">manages effects.</a> <span> <a href="https://package.elm-lang.org/packages/elm/core/latest/Platform-Cmd" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span> This latter point, more than anything, has given us the ability to structure our programs in a way that feels natural and easily maintainable. As I have been writing a lot more Elm during the past month, I have stumbled upon a few new, entirely tractable, problems that I would like to discuss.</p> <h2 id="decomposing-messages">Decomposing Messages</h2> <p>One such problem I have encountered while writing Elm applications over a certain size is an ever expanding <code class="language-plaintext highlighter-rouge">update</code> function that I am never really sure how to properly factor. It is easy to have a separate function for each branch of the <code class="language-plaintext highlighter-rouge">case</code> statement to handle each of the message types, but that can still lead to an extremely unwieldy function right in the core of the application logic. I typically want to be able to split this logic on a per-view basis, such that all the updates are self-contained in the model module for that view, rather than at the top level.</p> <p>Consider the following example, designed to invoke two simple menus: <code class="language-plaintext highlighter-rouge">File</code> and <code class="language-plaintext highlighter-rouge">Edit</code>. Each contains a number of commands, which are entirely handled by the <code class="language-plaintext highlighter-rouge">update</code> function, but the primary concern here is the <code class="language-plaintext highlighter-rouge">msgToString</code> function. We must also keep a separate <code class="language-plaintext highlighter-rouge">messages</code> list to be able to map over our type variants, which is mildly inconvenient, but not in particular bothersome.</p> <section class="example-embed"> <h4>StandardMsg.elm</h4> <h5>Source</h5> <figure class="highlight"><pre><code class="language-elm" data-lang="elm"><span class="k">import</span> <span class="kt">Browser</span>
<span class="k">import</span> <span class="kt">Html</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Html</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Html</span><span class="o">.</span><span class="kt">Events</span> <span class="k">as</span> <span class="kt">Events</span>

<span class="k">type</span> <span class="k">alias</span> <span class="kt">Model</span> <span class="o">=</span> <span class="kt">String</span>

<span class="k">type</span> <span class="kt">Msg</span>
  <span class="o">=</span> <span class="kt">FileNew</span>
  <span class="o">|</span> <span class="kt">FileOpen</span>
  <span class="o">|</span> <span class="kt">FileSave</span>
  <span class="o">|</span> <span class="kt">FilePrint</span>
  <span class="o">|</span> <span class="kt">FileQuit</span>
  <span class="o">|</span> <span class="kt">EditUndo</span>
  <span class="o">|</span> <span class="kt">EditRedo</span>
  <span class="o">|</span> <span class="kt">EditCopy</span>
  <span class="o">|</span> <span class="kt">EditCut</span>
  <span class="o">|</span> <span class="kt">EditPaste</span>

<span class="n">main</span> <span class="o">=</span> <span class="kt">Browser</span><span class="o">.</span><span class="n">sandbox</span>
  <span class="p">{</span> <span class="n">init</span> <span class="o">=</span> <span class="s">"</span><span class="s2">"</span><span class="o">,</span> <span class="n">update</span> <span class="o">=</span> <span class="n">update</span><span class="o">,</span> <span class="n">view</span> <span class="o">=</span> <span class="n">view</span> <span class="p">}</span>

<span class="n">update</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Model</span>
<span class="n">update</span> <span class="n">msg</span> <span class="n">model</span> <span class="o">=</span> <span class="n">msgToString</span> <span class="n">msg</span>

<span class="n">view</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">view</span> <span class="n">model</span> <span class="o">=</span>
  <span class="kt">Html</span><span class="o">.</span><span class="n">div</span>
    <span class="p">[]</span>
    <span class="p">((</span><span class="n">currentView</span> <span class="n">model</span><span class="p">)</span> <span class="o">::</span> <span class="p">(</span><span class="kt">List</span><span class="o">.</span><span class="n">map</span> <span class="n">button</span> <span class="n">messages</span><span class="p">))</span>

<span class="n">currentView</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">currentView</span> <span class="n">model</span> <span class="o">=</span>
  <span class="kt">Html</span><span class="o">.</span><span class="n">div</span> <span class="p">[]</span> <span class="p">[</span> <span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="p">(</span><span class="s">"</span><span class="s2">Current View: "</span> <span class="o">++</span> <span class="n">model</span><span class="p">)</span> <span class="p">]</span>

<span class="n">button</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">button</span> <span class="n">msg</span> <span class="o">=</span>
  <span class="kt">Html</span><span class="o">.</span><span class="n">button</span>
    <span class="p">[</span> <span class="kt">Events</span><span class="o">.</span><span class="n">onClick</span> <span class="n">msg</span> <span class="p">]</span>
    <span class="p">[</span> <span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="p">(</span><span class="n">msgToString</span> <span class="n">msg</span><span class="p">)</span> <span class="p">]</span>

<span class="n">msgToString</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">String</span>
<span class="n">msgToString</span> <span class="n">msg</span> <span class="o">=</span>
  <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
    <span class="kt">FileNew</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">File &gt; New"</span>
    <span class="kt">FileOpen</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">File &gt; Open"</span>
    <span class="kt">FileSave</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">File &gt; Save"</span>
    <span class="kt">FilePrint</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">File &gt; Print"</span>
    <span class="kt">FileQuit</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">File &gt; Quit"</span>
    <span class="kt">EditUndo</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">Edit &gt; Undo"</span>
    <span class="kt">EditRedo</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">Edit &gt; Redo"</span>
    <span class="kt">EditCopy</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">Edit &gt; Copy"</span>
    <span class="kt">EditCut</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">Edit &gt; Cut"</span>
    <span class="kt">EditPaste</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">Edit &gt; Paste"</span>

<span class="n">messages</span> <span class="p">:</span> <span class="kt">List</span> <span class="kt">Msg</span>
<span class="n">messages</span> <span class="o">=</span>
  <span class="p">[</span> <span class="kt">FileNew</span>
  <span class="o">,</span> <span class="kt">FileOpen</span>
  <span class="o">,</span> <span class="kt">FileSave</span>
  <span class="o">,</span> <span class="kt">FilePrint</span>
  <span class="o">,</span> <span class="kt">FileQuit</span>
  <span class="o">,</span> <span class="kt">EditUndo</span>
  <span class="o">,</span> <span class="kt">EditRedo</span>
  <span class="o">,</span> <span class="kt">EditCopy</span>
  <span class="o">,</span> <span class="kt">EditCut</span>
  <span class="o">,</span> <span class="kt">EditPaste</span>
  <span class="p">]</span></code></pre></figure> <h5><a href="/examples/elm/StandardMsg/" target="_new">View Result <svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a></h5> </section> <p>But, what if we wanted to be able to treat the <code class="language-plaintext highlighter-rouge">File</code> commands and the <code class="language-plaintext highlighter-rouge">Edit</code> commands separately? At first, it may not be apparent how to accomplish this goal, but it is not only feasible, but rather simple. The major change is just the following: modify our <code class="language-plaintext highlighter-rouge">Msg</code> type so that each of its variants takes a value. This value is a separate type that is specific to the variant. In practice, this looks like: <code class="language-plaintext highlighter-rouge">type Msg = File FileMsg | Edit EditMsg</code>. Then, we simply define our two new <code class="language-plaintext highlighter-rouge">FileMsg</code> and <code class="language-plaintext highlighter-rouge">EditMsg</code> types to contain all their respective subordinate messages.</p> <p>The following implementation exhibits the exact same behavior as the original, but using the <code class="language-plaintext highlighter-rouge">File</code> and <code class="language-plaintext highlighter-rouge">Edit</code> variants of our top-level <code class="language-plaintext highlighter-rouge">Msg</code> type to act like containers for our <code class="language-plaintext highlighter-rouge">FileMsg</code> and <code class="language-plaintext highlighter-rouge">EditMsg</code> types, respectively. It also shows how this technique can be used to factor out logic that is common to each top-level message.</p> <section class="example-embed"> <h4>DecomposedMsg.elm</h4> <h5>Source</h5> <figure class="highlight"><pre><code class="language-elm" data-lang="elm"><span class="k">import</span> <span class="kt">Browser</span>
<span class="k">import</span> <span class="kt">Html</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Html</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Html</span><span class="o">.</span><span class="kt">Events</span> <span class="k">as</span> <span class="kt">Events</span>

<span class="k">type</span> <span class="k">alias</span> <span class="kt">Model</span> <span class="o">=</span> <span class="kt">String</span>

<span class="k">type</span> <span class="kt">Msg</span> <span class="o">=</span> <span class="kt">File</span> <span class="kt">FileMsg</span> <span class="o">|</span> <span class="kt">Edit</span> <span class="kt">EditMsg</span>

<span class="k">type</span> <span class="kt">FileMsg</span>
  <span class="o">=</span> <span class="kt">New</span>
  <span class="o">|</span> <span class="kt">Open</span>
  <span class="o">|</span> <span class="kt">Save</span>
  <span class="o">|</span> <span class="kt">Print</span>
  <span class="o">|</span> <span class="kt">Quit</span>

<span class="k">type</span> <span class="kt">EditMsg</span>
  <span class="o">=</span> <span class="kt">Undo</span>
  <span class="o">|</span> <span class="kt">Redo</span>
  <span class="o">|</span> <span class="kt">Copy</span>
  <span class="o">|</span> <span class="kt">Cut</span>
  <span class="o">|</span> <span class="kt">Paste</span>

<span class="n">main</span> <span class="o">=</span> <span class="kt">Browser</span><span class="o">.</span><span class="n">sandbox</span>
  <span class="p">{</span> <span class="n">init</span> <span class="o">=</span> <span class="s">"</span><span class="s2">"</span><span class="o">,</span> <span class="n">update</span> <span class="o">=</span> <span class="n">update</span><span class="o">,</span> <span class="n">view</span> <span class="o">=</span> <span class="n">view</span> <span class="p">}</span>

<span class="n">update</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Model</span>
<span class="n">update</span> <span class="n">msg</span> <span class="n">model</span> <span class="o">=</span> <span class="n">msgToString</span> <span class="n">msg</span>

<span class="n">view</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">view</span> <span class="n">model</span> <span class="o">=</span>
  <span class="kt">Html</span><span class="o">.</span><span class="n">div</span>
    <span class="p">[]</span>
    <span class="p">((</span><span class="n">currentView</span> <span class="n">model</span><span class="p">)</span> <span class="o">::</span> <span class="p">(</span><span class="kt">List</span><span class="o">.</span><span class="n">map</span> <span class="n">button</span> <span class="n">messages</span><span class="p">))</span>

<span class="n">currentView</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">currentView</span> <span class="n">model</span> <span class="o">=</span>
  <span class="kt">Html</span><span class="o">.</span><span class="n">div</span> <span class="p">[]</span> <span class="p">[</span> <span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="p">(</span><span class="s">"</span><span class="s2">Current View: "</span> <span class="o">++</span> <span class="n">model</span><span class="p">)</span> <span class="p">]</span>

<span class="n">button</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">button</span> <span class="n">msg</span> <span class="o">=</span>
  <span class="kt">Html</span><span class="o">.</span><span class="n">button</span>
    <span class="p">[</span> <span class="kt">Events</span><span class="o">.</span><span class="n">onClick</span> <span class="n">msg</span> <span class="p">]</span>
    <span class="p">[</span> <span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="p">(</span><span class="n">msgToString</span> <span class="n">msg</span><span class="p">)</span> <span class="p">]</span>

<span class="n">msgToString</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">String</span>
<span class="n">msgToString</span> <span class="n">msg</span> <span class="o">=</span>
  <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
    <span class="kt">File</span> <span class="n">fileMsg</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">File &gt; "</span> <span class="o">++</span> <span class="n">fileMsgToString</span> <span class="n">fileMsg</span>
    <span class="kt">Edit</span> <span class="n">editMsg</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">Edit &gt; "</span> <span class="o">++</span> <span class="n">editMsgToString</span> <span class="n">editMsg</span>

<span class="n">fileMsgToString</span> <span class="p">:</span> <span class="kt">FileMsg</span> <span class="o">-&gt;</span> <span class="kt">String</span>
<span class="n">fileMsgToString</span> <span class="n">fileMsg</span> <span class="o">=</span>
  <span class="k">case</span> <span class="n">fileMsg</span> <span class="k">of</span>
    <span class="kt">New</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">New"</span>
    <span class="kt">Open</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">Open"</span>
    <span class="kt">Save</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">Save"</span>
    <span class="kt">Print</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">Print"</span>
    <span class="kt">Quit</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">Quit"</span>

<span class="n">editMsgToString</span> <span class="p">:</span> <span class="kt">EditMsg</span> <span class="o">-&gt;</span> <span class="kt">String</span>
<span class="n">editMsgToString</span> <span class="n">editMsg</span> <span class="o">=</span>
  <span class="k">case</span> <span class="n">editMsg</span> <span class="k">of</span>
    <span class="kt">Undo</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">Undo"</span>
    <span class="kt">Redo</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">Redo"</span>
    <span class="kt">Copy</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">Copy"</span>
    <span class="kt">Cut</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">Cut"</span>
    <span class="kt">Paste</span> <span class="o">-&gt;</span> <span class="s">"</span><span class="s2">Paste"</span>

<span class="n">messages</span> <span class="p">:</span> <span class="kt">List</span> <span class="kt">Msg</span>
<span class="n">messages</span> <span class="o">=</span>
  <span class="p">[</span> <span class="kt">File</span> <span class="kt">New</span>
  <span class="o">,</span> <span class="kt">File</span> <span class="kt">Open</span>
  <span class="o">,</span> <span class="kt">File</span> <span class="kt">Save</span>
  <span class="o">,</span> <span class="kt">File</span> <span class="kt">Print</span>
  <span class="o">,</span> <span class="kt">File</span> <span class="kt">Quit</span>
  <span class="o">,</span> <span class="kt">Edit</span> <span class="kt">Undo</span>
  <span class="o">,</span> <span class="kt">Edit</span> <span class="kt">Redo</span>
  <span class="o">,</span> <span class="kt">Edit</span> <span class="kt">Copy</span>
  <span class="o">,</span> <span class="kt">Edit</span> <span class="kt">Cut</span>
  <span class="o">,</span> <span class="kt">Edit</span> <span class="kt">Paste</span>
  <span class="p">]</span></code></pre></figure> <h5><a href="/examples/elm/DecomposedMsg/" target="_new">View Result <svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a></h5> </section> <p>We can see that this worked exactly as expected and already pays dividends at a small scale. This becomes even more important in larger applications, where the update function can be split up across many modules that encapsulate the logic for specific parts of the application.</p> <h2 id="ad-hoc-polymorphism">Ad Hoc Polymorphism</h2> <p>This next technique somehow feels like abusing the type system, while still working entirely within is boundaries. In particular, we are going to devise a way to treat different types of things as through they were the same. We are going to effectively define a method for achieving <span class="fancylink"> <a href="https://en.wikipedia.org/wiki/Ad_hoc_polymorphism">ad hoc polymorphism</a> <span> <a href="https://en.wikipedia.org/wiki/Ad_hoc_polymorphism" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span> in Elm.</p> <p>The example I am using here will hopefully resonate with most readers: simple form controls. Imagine we have radio buttons and checkboxes, which both have a lot of shared behavior, but also the distinct behavior that one only allows for a single selection, while the other allows for any number of selection. So long as we do not need to mix these on the page, it is easy enough to define them separately and simply <code class="language-plaintext highlighter-rouge">map</code> over the lists of each and composing the HTML result afterwards, as in the following example.</p> <p>This example has two simple type aliases for a <code class="language-plaintext highlighter-rouge">Radio</code> and a <code class="language-plaintext highlighter-rouge">Checkbox</code>. They both share a common <code class="language-plaintext highlighter-rouge">label: String</code> field, but differ in that their <code class="language-plaintext highlighter-rouge">value</code> fields have types of <code class="language-plaintext highlighter-rouge">String</code> and <code class="language-plaintext highlighter-rouge">List String</code> respectively. In this case, it would not be impossible to simply allow radio buttons to have a list of values, but, for the sake of argument, imagine such a solution were not tenable.</p> <section class="example-embed"> <h4>StandardTypeAlias.elm</h4> <h5>Source</h5> <figure class="highlight"><pre><code class="language-elm" data-lang="elm"><span class="k">import</span> <span class="kt">Browser</span>
<span class="k">import</span> <span class="kt">Html</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Html</span><span class="p">)</span>

<span class="k">type</span> <span class="k">alias</span> <span class="kt">Radio</span> <span class="o">=</span>
  <span class="p">{</span> <span class="n">label</span><span class="p">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">selected</span><span class="p">:</span> <span class="kt">String</span><span class="p">}</span>

<span class="k">type</span> <span class="k">alias</span> <span class="kt">Checkbox</span> <span class="o">=</span>
  <span class="p">{</span> <span class="n">label</span><span class="p">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">selected</span><span class="p">:</span> <span class="kt">List</span> <span class="kt">String</span> <span class="p">}</span>

<span class="n">radios</span> <span class="p">:</span> <span class="kt">List</span> <span class="kt">Radio</span>
<span class="n">radios</span> <span class="o">=</span>
  <span class="p">[</span> <span class="kt">Radio</span> <span class="s">"</span><span class="s2">First Radio"</span> <span class="s">"</span><span class="s2">First Selection"</span>
  <span class="o">,</span> <span class="kt">Radio</span> <span class="s">"</span><span class="s2">Second Radio"</span> <span class="s">"</span><span class="s2">Second Selection"</span>
  <span class="p">]</span>

<span class="n">checkboxes</span> <span class="p">:</span> <span class="kt">List</span> <span class="kt">Checkbox</span>
<span class="n">checkboxes</span> <span class="o">=</span>
  <span class="p">[</span> <span class="kt">Checkbox</span> <span class="s">"</span><span class="s2">First Checkbox"</span> <span class="p">[</span> <span class="s">"</span><span class="s2">First Selection One"</span><span class="o">,</span> <span class="s">"</span><span class="s2">First Selection Two"</span> <span class="p">]</span>
  <span class="o">,</span> <span class="kt">Checkbox</span> <span class="s">"</span><span class="s2">Second Checkbox"</span> <span class="p">[</span> <span class="s">"</span><span class="s2">Second Selection One"</span><span class="o">,</span> <span class="s">"</span><span class="s2">Second Selection Two"</span> <span class="p">]</span>
  <span class="p">]</span>

<span class="n">main</span> <span class="o">=</span> <span class="kt">Browser</span><span class="o">.</span><span class="n">sandbox</span>
  <span class="p">{</span> <span class="n">init</span> <span class="o">=</span> <span class="p">()</span><span class="o">,</span> <span class="n">update</span> <span class="o">=</span> <span class="n">identity</span><span class="o">,</span> <span class="n">view</span> <span class="o">=</span> <span class="n">view</span> <span class="p">}</span>

<span class="n">view</span> <span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">())</span>
<span class="n">view</span> <span class="n">nothing</span> <span class="o">=</span>
  <span class="n">div</span> <span class="p">(</span><span class="kt">List</span><span class="o">.</span><span class="n">append</span>
    <span class="p">(</span><span class="kt">List</span><span class="o">.</span><span class="n">map</span> <span class="n">radio</span> <span class="n">radios</span><span class="p">)</span>
    <span class="p">(</span><span class="kt">List</span><span class="o">.</span><span class="n">map</span> <span class="n">checkbox</span> <span class="n">checkboxes</span><span class="p">))</span>

<span class="n">radio</span> <span class="p">:</span> <span class="kt">Radio</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="n">msg</span>
<span class="n">radio</span> <span class="p">{</span><span class="n">label</span><span class="o">,</span> <span class="n">selected</span><span class="p">}</span> <span class="o">=</span>
  <span class="n">div</span> <span class="p">[</span> <span class="p">(</span><span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="p">(</span><span class="n">label</span> <span class="o">++</span> <span class="s">"</span><span class="s2">: "</span> <span class="o">++</span> <span class="n">selected</span><span class="p">))</span> <span class="p">]</span>

<span class="n">checkbox</span> <span class="p">:</span> <span class="kt">Checkbox</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="n">msg</span>
<span class="n">checkbox</span> <span class="p">{</span><span class="n">label</span><span class="o">,</span> <span class="n">selected</span><span class="p">}</span> <span class="o">=</span>
  <span class="n">div</span> <span class="p">[</span> <span class="p">(</span><span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="p">(</span><span class="n">label</span> <span class="o">++</span> <span class="s">"</span><span class="s2">: "</span> <span class="o">++</span> <span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="n">join</span> <span class="s">"</span><span class="s2">, "</span> <span class="n">selected</span><span class="p">)))</span> <span class="p">]</span>

<span class="n">div</span> <span class="p">:</span> <span class="kt">List</span> <span class="p">(</span><span class="kt">Html</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="n">msg</span>
<span class="n">div</span> <span class="o">=</span> <span class="kt">Html</span><span class="o">.</span><span class="n">div</span> <span class="p">[]</span></code></pre></figure> <h5><a href="/examples/elm/StandardTypeAlias/" target="_new">View Result <svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a></h5> </section> <p>But what if we need to have a mixture of radios and checkboxes throughout our form? We can do something horrifying, like having <code class="language-plaintext highlighter-rouge">firstRadio</code>, <code class="language-plaintext highlighter-rouge">secondRadio</code>, <code class="language-plaintext highlighter-rouge">firstCheckbox</code>, and <code class="language-plaintext highlighter-rouge">secondCheckbox</code> functions, which certainly works in simple cases, but not so much in the real world. What we really want, though, is to be able to treat radios and checkboxes the same; we want them to be polymorphic. Since Elm does not support <span class="fancylink"> <a href="https://en.wikipedia.org/wiki/Type_class">type classes</a> <span> <a href="https://en.wikipedia.org/wiki/Type_class" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span> this must be impossible. There are <span class="fancylink"> <a href="https://medium.com/@eeue56/why-type-classes-arent-importNotNiniant-in-elm-yet-dd55be125c81">other ways</a> <span> <a href="https://medium.com/@eeue56/why-type-classes-arent-importNotNiniant-in-elm-yet-dd55be125c81" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span> to work around this <span class="fancylink"> <a href="https://github.com/elm/compiler/issues/38">current limitation</a> <span> <a href="https://github.com/elm/compiler/issues/38" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span>, but there it is also possible to leverage the type system to accomplish something very similar.</p> <p>This technique borrows its name from Eric Evanâ€™s book Domain-Driven Design, although it takes on a very different meaning. Still, it is worth understanding the origin of the term, so here is the original definition as an aside:</p> <blockquote> <p> A specification is a predicate that determines if an object does or does not satisfy some criteria. Many specifications are simple [...]. In cases where the rules are complex, the concept can be extended to allow simple specifications to be combined, just as predicates are combined with logical operators. [...] The fundamental pattern stays the same and provides a path from the simpler to more complex models. </p> </blockquote> <p>In our example, instead of specifications being a predicate, they instead function as an augment to some other type. This means we are able to have some shared behavior in a base type and then add additional behavior to that type. This is reminiscent of <span class="fancylink"> <a href="https://elm-lang.org/docs/records#record-types">extensible records</a> <span> <a href="https://elm-lang.org/docs/records#record-types" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span>, but also somewhat different.</p> <p>We start by creating a single, higher-order type, a <code class="language-plaintext highlighter-rouge">Control</code> that will encapsulate the shared behavior of both radios and checkboxes, specifically having a <code class="language-plaintext highlighter-rouge">label</code> and a <code class="language-plaintext highlighter-rouge">spec</code> field. The <code class="language-plaintext highlighter-rouge">Specification</code> type is defined in the same way as the decomposed messages in the first example, with the type acting like a box for holding a specification. In this example, the <code class="language-plaintext highlighter-rouge">Radio</code> and <code class="language-plaintext highlighter-rouge">Checkbox</code> types work as concrete implementations of a specification. Lastly, we simply need to define our list of controls, write a view function to handle them, and modify our other view functions slightly to also accept a specification.</p> <section class="example-embed"> <h4>PolymorphicTypeAlias.elm</h4> <h5>Source</h5> <figure class="highlight"><pre><code class="language-elm" data-lang="elm"><span class="k">import</span> <span class="kt">Browser</span>
<span class="k">import</span> <span class="kt">Html</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Html</span><span class="p">)</span>

<span class="k">type</span> <span class="kt">Specification</span>
  <span class="o">=</span> <span class="kt">RadioSpec</span> <span class="kt">Radio</span>
  <span class="o">|</span> <span class="kt">CheckboxSpec</span> <span class="kt">Checkbox</span>

<span class="k">type</span> <span class="k">alias</span> <span class="kt">Control</span> <span class="o">=</span>
  <span class="p">{</span> <span class="n">label</span><span class="p">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">spec</span><span class="p">:</span> <span class="kt">Specification</span> <span class="p">}</span>

<span class="k">type</span> <span class="k">alias</span> <span class="kt">Radio</span> <span class="o">=</span>
  <span class="p">{</span> <span class="n">selected</span><span class="p">:</span> <span class="kt">String</span> <span class="p">}</span>

<span class="k">type</span> <span class="k">alias</span> <span class="kt">Checkbox</span> <span class="o">=</span>
  <span class="p">{</span> <span class="n">selected</span><span class="p">:</span> <span class="kt">List</span> <span class="kt">String</span> <span class="p">}</span>

<span class="n">controls</span> <span class="p">:</span> <span class="kt">List</span> <span class="kt">Control</span>
<span class="n">controls</span> <span class="o">=</span>
  <span class="p">[</span> <span class="kt">Control</span>
      <span class="s">"</span><span class="s2">First Radio"</span>
      <span class="p">(</span><span class="kt">RadioSpec</span> <span class="p">(</span><span class="kt">Radio</span> <span class="s">"</span><span class="s2">First Selection"</span><span class="p">))</span>

  <span class="o">,</span> <span class="kt">Control</span>
      <span class="s">"</span><span class="s2">First Checkbox"</span>
      <span class="p">(</span><span class="kt">CheckboxSpec</span> <span class="p">(</span><span class="kt">Checkbox</span> <span class="p">[</span> <span class="s">"</span><span class="s2">First Selection One"</span><span class="o">,</span> <span class="s">"</span><span class="s2">First Selection Two"</span> <span class="p">]))</span>

  <span class="o">,</span> <span class="kt">Control</span>
      <span class="s">"</span><span class="s2">Second Radio"</span>
      <span class="p">(</span><span class="kt">RadioSpec</span> <span class="p">(</span><span class="kt">Radio</span> <span class="s">"</span><span class="s2">Second Selection"</span><span class="p">))</span>

  <span class="o">,</span> <span class="kt">Control</span>
      <span class="s">"</span><span class="s2">Second Checkbox"</span>
      <span class="p">(</span><span class="kt">CheckboxSpec</span> <span class="p">(</span><span class="kt">Checkbox</span> <span class="p">[</span> <span class="s">"</span><span class="s2">Second Selection One"</span><span class="o">,</span> <span class="s">"</span><span class="s2">Second Selection Two"</span> <span class="p">]))</span>
  <span class="p">]</span>

<span class="n">main</span> <span class="o">=</span> <span class="kt">Browser</span><span class="o">.</span><span class="n">sandbox</span>
  <span class="p">{</span> <span class="n">init</span> <span class="o">=</span> <span class="p">()</span><span class="o">,</span> <span class="n">update</span> <span class="o">=</span> <span class="n">identity</span><span class="o">,</span> <span class="n">view</span> <span class="o">=</span> <span class="n">view</span> <span class="p">}</span>

<span class="n">view</span> <span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">())</span>
<span class="n">view</span> <span class="n">nothing</span> <span class="o">=</span>
  <span class="n">div</span> <span class="p">(</span><span class="kt">List</span><span class="o">.</span><span class="n">map</span> <span class="n">control</span> <span class="n">controls</span><span class="p">)</span>

<span class="n">control</span> <span class="p">:</span> <span class="kt">Control</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="n">msg</span>
<span class="n">control</span> <span class="p">({</span><span class="n">spec</span><span class="p">}</span> <span class="k">as</span> <span class="n">ctrl</span><span class="p">)</span> <span class="o">=</span>
  <span class="k">case</span> <span class="n">spec</span> <span class="k">of</span>
    <span class="kt">RadioSpec</span> <span class="n">radioSpec</span> <span class="o">-&gt;</span> <span class="n">radio</span> <span class="n">ctrl</span> <span class="n">radioSpec</span>
    <span class="kt">CheckboxSpec</span> <span class="n">checkboxSpec</span> <span class="o">-&gt;</span> <span class="n">checkbox</span> <span class="n">ctrl</span> <span class="n">checkboxSpec</span>

<span class="n">radio</span> <span class="p">:</span> <span class="kt">Control</span> <span class="o">-&gt;</span> <span class="kt">Radio</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="n">msg</span>
<span class="n">radio</span> <span class="p">{</span><span class="n">label</span><span class="p">}</span> <span class="p">{</span><span class="n">selected</span><span class="p">}</span> <span class="o">=</span>
  <span class="n">div</span> <span class="p">[</span> <span class="p">(</span><span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="p">(</span><span class="n">label</span> <span class="o">++</span> <span class="s">"</span><span class="s2">: "</span> <span class="o">++</span> <span class="n">selected</span><span class="p">))</span> <span class="p">]</span>

<span class="n">checkbox</span> <span class="p">:</span> <span class="kt">Control</span> <span class="o">-&gt;</span> <span class="kt">Checkbox</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="n">msg</span>
<span class="n">checkbox</span> <span class="p">{</span><span class="n">label</span><span class="p">}</span> <span class="p">{</span><span class="n">selected</span><span class="p">}</span> <span class="o">=</span>
  <span class="n">div</span> <span class="p">[</span> <span class="p">(</span><span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="p">(</span><span class="n">label</span> <span class="o">++</span> <span class="s">"</span><span class="s2">: "</span> <span class="o">++</span> <span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="n">join</span> <span class="s">"</span><span class="s2">, "</span> <span class="n">selected</span><span class="p">)))</span> <span class="p">]</span>

<span class="n">div</span> <span class="p">:</span> <span class="kt">List</span> <span class="p">(</span><span class="kt">Html</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="n">msg</span>
<span class="n">div</span> <span class="o">=</span> <span class="kt">Html</span><span class="o">.</span><span class="n">div</span> <span class="p">[]</span></code></pre></figure> <h5><a href="/examples/elm/PolymorphicTypeAlias/" target="_new">View Result <svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a></h5> </section> <p>As this example shows, we have found a way to treat checkboxes and radio buttons as if they were they were simply controls. In practice, I have found this to be extremely useful, albeit a little strange. There is a bit more boilerplate in defining our list of <code class="language-plaintext highlighter-rouge">controls</code>, but other than a few additional type constructors, it amounts to very little.</p> <h2 id="reductio-ad-minimum">Reductio Ad Minimum</h2> <p>These two techniques can significantly simplify certain aspects of an Elm application. Decomposing messages to make our main <code class="language-plaintext highlighter-rouge">update</code> function easer to understand at a glance by factoring out the concerns into separate functions that can then be stored in separate modules. Using the ad hoc polymorphism outlined above makes it possible to for us to combine related sets of data and treat them as functionally equivalent. This could probably be abused, but in reasonable situations, appears to be a safe technique to deploy.</p> <p>One thing I often struggle with when writing Elm is making large-scale changes to my types, such as the ones above. The way that types <span class="fancylink"> <a href="https://guide.elm-lang.org/types/">flow</a> <span> <a href="https://guide.elm-lang.org/types/" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span> through the application is one of the nicest aspects of working with Elm. While greatly simplifying refactors by the compiler identifying and helping to fix mistakes, the flow of types can have cascading effects during experimental changes that are difficult to untangle. In these cases, my solution is to construct an example that is reduced to the bare minimum of moving parts. The examples in this article are exactly that: the result of my inability to concretely understand how to accomplish these goals in a real application, and me resorting to a scratch pad to work through them conceptually. Once I arrive at a concrete implementation, I am then able to apply that to my actual problem.</p> <p>Often there is no recourse other than trimming away as much non-essential information as possible to help me understand the issue at hand.</p> <p>In conclusion, I want to reinforce that there is no better time than now to try out Elm. The <span class="fancylink"> <a href="https://guide.elm-lang.org/">guide</a> <span> <a href="https://guide.elm-lang.org/" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M3.75 2h3.5a.75.75 0 0 1 0 1.5h-3.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25v-3.5a.75.75 0 0 1 1.5 0v3.5A1.75 1.75 0 0 1 12.25 14h-8.5A1.75 1.75 0 0 1 2 12.25v-8.5C2 2.784 2.784 2 3.75 2Zm6.854-1h4.146a.25.25 0 0 1 .25.25v4.146a.25.25 0 0 1-.427.177L13.03 4.03 9.28 7.78a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042l3.75-3.75-1.543-1.543A.25.25 0 0 1 10.604 1Z"></path></svg></a> </span> </span> is a great resource and a perfect place to start.</p> <span class="post-date">19 Nov 2018</span> </div> <div class="related"> <h2>Related Posts</h2> <ul class="related-posts"> <li> <h3> <a href="/2017/06/18/on-maintainability-gold-plating-the-game-of-life-in-elm/"> On Maintainability: Gold Plating the Game of Life in Elm <small>18 Jun 2017</small> </a> </h3> </li> <li> <h3> <a href="/2018/01/03/privacy-and-exposure-gatekeeprs-and-privileged-consumers/"> Privacy and Exposure, Gatekeepers and Privileged Consumers <small>03 Jan 2018</small> </a> </h3> </li> <li> <h3> <a href="/2017/06/05/common-table-expressions-in-activerecord-a-case-study-of-quantiles/"> Common Table Expressions in ActiveRecord: A Case Study of Quantiles <small>05 Jun 2017</small> </a> </h3> </li> </ul> </div> <p class="bitcoin"></p> </div> </body> </html>