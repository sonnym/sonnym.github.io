<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    Using Defined Properties for Better AngularJS Directives &middot; effluence
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/hyde.css">
  <link rel="stylesheet" href="/css/custom.css">

  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="layout-reverse">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>effluence</h1>
      <p class="lead"></p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
        <a href="/">home</a>
      </li>

      

      
        
      
        
          
            <li class="sidebar-nav-item">
              <a href="/projects/">projects</a>
            </li>
          
        
      
        
          
            <li class="sidebar-nav-item">
              <a href="/about/">about</a>
            </li>
          
        
      
        
          
        
      
        
          
        
      

      <li class="sidebar-nav-item">
        <a href="/atom.xml" target="_blank">rss</a>
      </li>
    </ul>

    <p>&copy; 2017. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Using Defined Properties for Better AngularJS Directives</h1>
  <h2>On Directives</h2>

<p>Directives in AngularJS are an exemplary solution for writing reusable
components in modern web applications. They allow us to encapsulate all the
messy business logic and expose a very clean, declarative interface to consumers
of the API. As with most tools for constructing abstractions, however,
directives have certain limitations that can lead to implementation details
leaking through, resulting in code that less
<span> <a href="https://en.wikipedia.org/wiki/DRY_principle">DRY</a> <span style="vertical-align: super"> <a href="https://en.wikipedia.org/wiki/DRY_principle" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 10h1v3c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h3v1H1v10h10v-3zM6 2l2.25 2.25L5 7.5 6.5 9l3.25-3.25L12 8V2H6z"/></svg></a>  </span> </span>
and, consequently, less maintainable.</p>

<p>There are, however, ways to work around these shortcomings and to build
simpler, more expressive interfaces to our directives. Leveraging a lesser known
feature of JavaScript, we can encapsulate additional details of our business
logic. This method is also well suited for building on top of third party
directives with a complex API by abstracting the details into a business
object. In doing so, our markup will become more in line with the ideal in
AngularJS, which
<span> <a href="https://docs.angularjs.org/guide/introduction">promotes declarative code</a> <span style="vertical-align: super"> <a href="https://docs.angularjs.org/guide/introduction" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 10h1v3c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h3v1H1v10h10v-3zM6 2l2.25 2.25L5 7.5 6.5 9l3.25-3.25L12 8V2H6z"/></svg></a>  </span> </span>
over imperative. Without further ado, let us look at the current situation and
how we can improve our directives.</p>

<h2>Motivation and Shortcomings</h2>

<p>The original motivation for this method arose when working with
<span> <a href="https://angular-ui.github.io/bootstrap/#/tabs">tabs component</a> <span style="vertical-align: super"> <a href="https://angular-ui.github.io/bootstrap/#/tabs" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 10h1v3c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h3v1H1v10h10v-3zM6 2l2.25 2.25L5 7.5 6.5 9l3.25-3.25L12 8V2H6z"/></svg></a>  </span> </span>
of AngularUI Bootstrap. Its <code>&lt;tabset&gt;</code> directive provides three settings with
clearly overlapping concerns: <code>active</code>, <code>select()</code>, and <code>deselect()</code>. This
redundancy forces users of the API to not only create functions in addition to
the <code>active</code> flag, but more importantly, to declare them in the markup. We
repeat this for all tabs in a given application, leading to additional
maintenance effort.</p>

<p>This example also exhibits a significant issue with directives and two-way
binding in AngularJS. If we want the active flag to be programmatically
determined, e.g. if we have push notifications from the server to affect the
active state of our tabs, we are required to use a <code>$watch</code> in our controller
to set the attribute on our object &mdash; something like the following:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">angular</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s2">&quot;TabsController&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;$scope&quot;</span><span class="p">,</span> <span class="s2">&quot;TabModel&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">TabModel</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">$watch</span><span class="p">(</span><span class="nx">TabModel</span><span class="p">.</span><span class="nx">activeFn</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">isTabActive</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">}]);</span></code></pre></figure>

<p>This boilerplate quickly accumulates, making our controllers fatter than they
optimally should be. We could move this logic into our service layer, but that
only deflects, not fundamentally solves, the issue.  One may surmise that,
perhaps, instead we could supply a function, but the
<span> <a href="https://code.angularjs.org/1.3.10/docs/api/ng/service/$compile#-scope-">two-way binding</a> <span style="vertical-align: super"> <a href="https://code.angularjs.org/1.3.10/docs/api/ng/service/$compile#-scope-" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 10h1v3c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h3v1H1v10h10v-3zM6 2l2.25 2.25L5 7.5 6.5 9l3.25-3.25L12 8V2H6z"/></svg></a>  </span> </span>
mechanism for directives requires that the property we specify be assignable.
As such, we cannot use our function as is to pass the value through the&#39;
interface of the directive.</p>

<h2>A Solution</h2>

<p>There is, however, a very simple way to circumvent both these issues with one
fairly small change.  Introduce the
<span> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty">Object.defineProperty</a> <span style="vertical-align: super"> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 10h1v3c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h3v1H1v10h10v-3zM6 2l2.25 2.25L5 7.5 6.5 9l3.25-3.25L12 8V2H6z"/></svg></a>  </span> </span>
method, part of the ECMAScript-262 standard. This extremely powerful method
gives us the ability to define custom properties on an object and control
aspects of it otherwise not available, such as its enumerability and whether or
not it can be written. For our purposes, the most important functionality is
the ability to define custom setter and getter methods for our property in a
manner that is completely transparent to users of the object.</p>

<p>We write a wrapper function for instances of our tab models, which need not be
the same type of service. This wrapper defines an <code>active</code> property to handle
both activating and deactivating the tab. We can also extend the default
wrapper to do additional work for us. In this case, we add a <code>notify</code> method to
the <code>TabWrapper</code> class which prevents notifications from being displayed on the
currently active tab, but could also be used to perform other operations, such
as automatically triggering updates in the model.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s2">&quot;TabWrapper&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">TabWrapper</span><span class="p">(</span><span class="nx">tabModel</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">model</span> <span class="o">=</span> <span class="nx">tabModel</span><span class="p">;</span>

    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">tabModel</span><span class="p">.</span><span class="nx">active</span><span class="p">;</span>
      <span class="p">},</span>

      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">&amp;&amp;</span> <span class="nx">tabModel</span><span class="p">.</span><span class="nx">activate</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">tabModel</span><span class="p">.</span><span class="nx">activate</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">val</span> <span class="o">&amp;&amp;</span> <span class="nx">tabModel</span><span class="p">.</span><span class="nx">deactivate</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">tabModel</span><span class="p">.</span><span class="nx">deactivate</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="nx">tabModel</span><span class="p">.</span><span class="nx">active</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">TabWrapper</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">notify</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">active</span> <span class="o">&amp;&amp;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">notify</span> <span class="o">&amp;&amp;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">notify</span><span class="p">();</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="nx">TabWrapper</span><span class="p">;</span>
<span class="p">});</span></code></pre></figure>

<p>In short, what we have accomplished is hiding all the details of how our tabs
operate in our service layer without any of it leaking into our controllers or
templates. So long as our services follow the simple interface defined by
<code>TabWrapper</code>, they will function seamlessly.</p>

<p>N.B. Using a wrapper class is a somewhat naive way of accomplishing this
technique, but it works well enough for these purposes. For a comprehensive
treatment on the subject of object composition and extension in JavaScript, I
cannot recommend highly enough Reginald Braithwaite&#39;s treatise on the topic:
<span> <a href="https://leanpub.com/javascript-spessore/read">JavaScript Spessore</a> <span style="vertical-align: super"> <a href="https://leanpub.com/javascript-spessore/read" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 10h1v3c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h3v1H1v10h10v-3zM6 2l2.25 2.25L5 7.5 6.5 9l3.25-3.25L12 8V2H6z"/></svg></a>  </span> </span>.</p>

<h2>An Example</h2>

<p><span> <a href="http://plnkr.co/edit/7X66uV?p=preview">Open in Plunkr</a> <span style="vertical-align: super"> <a href="http://plnkr.co/edit/7X66uV?p=preview" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 10h1v3c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h3v1H1v10h10v-3zM6 2l2.25 2.25L5 7.5 6.5 9l3.25-3.25L12 8V2H6z"/></svg></a>  </span> </span></p>

<p>Using the above service, we can construct a complete example of how this
process works. This example underscores all of the advantages discussed above.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;DefinedPropertyExample&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ui.bootstrap&quot;</span><span class="p">]);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s2">&quot;TabModel&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;$timeout&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$timeout</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">TabModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">active</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">notification</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">TabModel</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">activate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="s2">&quot;Some lazy content&quot;</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">TabModel</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">deactivate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">notification</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">$timeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">notification</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">},</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">5000</span><span class="p">));</span>
  <span class="p">};</span>

  <span class="nx">TabModel</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">notify</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">notification</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="nx">TabModel</span><span class="p">;</span>
<span class="p">}]);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s2">&quot;TabsCtrl&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;$scope&quot;</span><span class="p">,</span> <span class="s2">&quot;TabModel&quot;</span><span class="p">,</span> <span class="s2">&quot;TabWrapper&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">TabModel</span><span class="p">,</span> <span class="nx">TabWrapper</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">tabs</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">tabs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TabWrapper</span><span class="p">(</span><span class="k">new</span> <span class="nx">TabModel</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}]);</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span></span><span class="p">&lt;</span><span class="nt">body</span> <span class="na">ng-app</span><span class="o">=</span><span class="s">&quot;DefinedPropertyExample&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ng-controller</span><span class="o">=</span><span class="s">&quot;TabsCtrl&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">tabset</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">tab</span> <span class="na">ng-repeat</span><span class="o">=</span><span class="s">&quot;tab in tabs track by $index&quot;</span> <span class="na">active</span><span class="o">=</span><span class="s">&quot;tab.active&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tab-heading</span><span class="p">&gt;</span>
          Tab { { $index + 1 } }
          <span class="p">&lt;</span><span class="nt">span</span> <span class="na">ng-if</span><span class="o">=</span><span class="s">&quot;tab.notify()&quot;</span><span class="p">&gt;</span>!<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tab-heading</span><span class="p">&gt;</span>

        { { tab.model.content } }
      <span class="p">&lt;/</span><span class="nt">tab</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">tabset</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span></code></pre></figure>

<p>First, we create a service object to drive our tabs. This model conforms to the
interface we have specified, namely the <code>activate</code>, <code>deactivate</code>, and <code>notify</code>
methods, although our wrapper allows any or all of these to be omitted. The
<code>activate</code> method defines the content for our tab lazily, as though it were
being loaded from a server. The <code>deactivate</code> method resets any active
notification and creates a <code>$timeout</code> that will activate the notification
within five seconds, as though notifications were streaming from a server. And,
finally, the <code>notify</code> method simply returns the <code>notification</code> property, but
is written as a function so that it would be possible to easily extend it to
accumulate data from subordinate objects if ever necessary.</p>

<p>Our controller simply creates five of these tabs and wraps them. Our template
iterates over and displays them. We can see the first activate function operate
immediately, given the content being displayed in the first tab. After changing
tabs, we see an exclamation point appear next to any tabs with notifications,
which is then reset when reactivated (recall, this latter point is handled by
the wrapper).</p>

<h2>Conclusion</h2>

<p>The markup is cleaner, the controller knows nothing about the tabs, and all our
business logic exists in more or less pure JavaScript objects. All these points
are massive gains for maintainability, but the latter merits some emphasis.
Pushing as much of our logic down into simple, decoupled objects facilitates
writing tests &mdash; a practice that can use as much facilitation as possible.
Ultimately, any time we can find abstractions of this nature, they will benefit
the long term viability of our AngularJS applications.</p>

  <span class="post-date">21 Jan 2015</span>
</div>


  <div class="related">
    <h2>Related Posts</h2>
    <ul class="related-posts">
      
        <li>
          <h3>
            <a href="/2017/06/05/common-table-expressions-in-activerecord-a-case-study-of-quantiles/">
              Common Table Expressions in ActiveRecord: A Case Study of Quantiles
              <small>05 Jun 2017</small>
            </a>
          </h3>
        </li>
      
        <li>
          <h3>
            <a href="/2017/05/22/revisiting-the-game-of-life-in-elm/">
              Revisiting the Game of Life in Elm
              <small>22 May 2017</small>
            </a>
          </h3>
        </li>
      
        <li>
          <h3>
            <a href="/2014/02/05/hooks-in-angularjs-controllers/">
              Hooks in AngularJS Controllers
              <small>05 Feb 2014</small>
            </a>
          </h3>
        </li>
      
    </ul>
  </div>


<p class="bitcoin"></p>

    </div>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-47296801-1', 'sonnym.github.io');
      ga('send', 'pageview');
    </script>

  </body>
</html>
