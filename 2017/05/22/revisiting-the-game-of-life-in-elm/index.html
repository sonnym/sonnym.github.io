<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"> <head> <link href="http://gmpg.org/xfn/11" rel="profile"> <meta http-equiv="content-type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"> <title> Revisiting the Game of Life in Elm &middot; effluence </title> <link rel="stylesheet" href="/css/poole.css"> <link rel="stylesheet" href="/css/syntax.css"> <link rel="stylesheet" href="/css/hyde.css"> <link rel="stylesheet" href="/css/custom.css"> <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"> <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"> </head> <body class="layout-reverse"> <div class="sidebar"> <div class="container sidebar-sticky"> <div class="sidebar-about"> <h1>effluence</h1> <p class="lead"></p> </div> <ul class="sidebar-nav"> <li class="sidebar-nav-item"> <a href="/">home</a> </li> <li class="sidebar-nav-item"> <a href="/projects/">projects</a> </li> <li class="sidebar-nav-item"> <a href="/about/">about</a> </li> <li class="sidebar-nav-item"> <a href="/atom.xml" target="_blank">rss</a> </li> </ul> <p>&copy; 2017. All rights reserved.</p> </div> </div> <div class="content container"> <div class="post"> <h1 class="post-title">Revisiting the Game of Life in Elm</h1> <h2>Reflection</h2> <p>Over three years ago, I wrote an <a href="/2014/05/05/writing-game-of-life-in-elm/">article</a> exploring how to write Conway&#39;s Game of Life in the Elm programming language. That article was originally written for version 0.12.3 and later updated for 0.14, but during the intervening span of time, Elm has matured significantly. In the process, Elm has <span> <a href="http://elm-lang.org/blog/farewell-to-frp">dropped its functional reactive roots</a> <span style="vertical-align: super"> <a href="http://elm-lang.org/blog/farewell-to-frp" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 10h1v3c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h3v1H1v10h10v-3zM6 2l2.25 2.25L5 7.5 6.5 9l3.25-3.25L12 8V2H6z"/></svg></a> </span> </span> in favor of subscription-based concurrency. Today, we will go through the same exercise of writing the game of life, as a means of exploring the basics of a simple modern Elm program.</p> <p>If you have worked with Elm in the past, but several versions in the past, some history may help frame some of the changes. (N.B. While I was actively following the discussions leading up to the release of version 0.15, I was absent for some of the later versions, and, as such, this may not be a perfectly accurate retelling.) While the unifying concept of all changes being a signal is very elegant, in practice, certain issues arose. One such common obstacle was with the behavior of <span> <a href="https://groups.google.com/d/msg/elm-discuss/z1g8EEkgOBU/3uPXAU8GAwAJ">initial values in signals</a> <span style="vertical-align: super"> <a href="https://groups.google.com/d/msg/elm-discuss/z1g8EEkgOBU/3uPXAU8GAwAJ" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 10h1v3c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h3v1H1v10h10v-3zM6 2l2.25 2.25L5 7.5 6.5 9l3.25-3.25L12 8V2H6z"/></svg></a> </span> </span>, especially when that value could be <code>undefined</code> coming from JavaScript.</p> <p>Another major point of pain, at least in my experience, was the way in which channels worked. Since one of the major overhauls of the language going to version 0.15 was the removal of this feature in favor of <span> <a href="http://elm-lang.org/blog/announce/0.15">tasks, mailboxes, and addresses</a> <span style="vertical-align: super"> <a href="http://elm-lang.org/blog/announce/0.15" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 10h1v3c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h3v1H1v10h10v-3zM6 2l2.25 2.25L5 7.5 6.5 9l3.25-3.25L12 8V2H6z"/></svg></a> </span> </span>, it is safe to presume this was less than intuitive for many other users. To avoid belaboring the point, suffice to say, today all these concepts &mdash; signals, channels, tasks, mailboxes, addresses &mdash; have been superceded by two simple, complementary concepts: commands and subscriptions.</p> <p>While there have been numerous other changes, they are largely tangential to the conceptual core of Elm, so, let us begin, again.</p> <h2>Rejuvenation</h2> <p>As we began in the original article, so we shall here: we simply want to draw a static grid on the screen. This will introduce us to a number of core aspects of the language, without, hopefully, being overwhelming.</p> <h4>static_grid.elm</h4> <h5>Source</h5> <figure class="highlight"><pre><code class="language-elm" data-lang="elm"><span></span><span class="kn">import </span><span class="nc">List</span>

<span class="kn">import </span><span class="nc">Html</span> <span class="nv">exposing</span> <span class="p">(</span><span class="kt">Html</span><span class="p">,</span> <span class="kt">Attribute</span><span class="p">,</span> <span class="nv">div</span><span class="p">,</span> <span class="nv">text</span><span class="p">)</span>
<span class="kn">import </span><span class="nc">Html.Attributes</span> <span class="nv">exposing</span> <span class="p">(</span><span class="nv">style</span><span class="p">)</span>

<span class="kr">type</span> <span class="kr">alias</span> <span class="kt">Grid</span> <span class="nf">=</span> <span class="kt">List</span> <span class="p">(</span><span class="kt">List</span> <span class="kt">Bool</span><span class="p">)</span>

<span class="nv">cellSize</span> <span class="nf">=</span> <span class="mi">5</span>
<span class="p">(</span><span class="nv">columns</span><span class="p">,</span> <span class="nv">rows</span><span class="p">)</span> <span class="nf">=</span> <span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>

<span class="kr">main </span><span class="nf">=</span> <span class="kt">Html</span><span class="nf">.</span><span class="nv">beginnerProgram</span> <span class="p">{</span> <span class="nv">model</span> <span class="nf">=</span> <span class="nv">model</span><span class="p">,</span> <span class="nv">view</span> <span class="nf">=</span> <span class="nv">view</span><span class="p">,</span> <span class="nv">update</span> <span class="nf">=</span> <span class="nv">never</span> <span class="p">}</span>

<span class="nv">model</span> <span class="nf">:</span> <span class="kt">Grid</span>
<span class="nv">model</span> <span class="nf">=</span> <span class="kt">List</span><span class="nf">.</span><span class="nv">repeat</span> <span class="nv">rows</span> <span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">repeat</span> <span class="nv">columns</span> <span class="kt">True</span><span class="p">)</span>

<span class="nv">view</span> <span class="nf">:</span> <span class="kt">Grid</span> <span class="nf">-&gt;</span> <span class="kt">Html</span> <span class="nv">msg</span>
<span class="nv">view</span> <span class="nv">grid</span> <span class="nf">=</span> <span class="nv">div</span> <span class="p">[</span> <span class="p">]</span> <span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span> <span class="nv">row</span> <span class="nv">grid</span><span class="p">)</span>

<span class="nv">row</span> <span class="nf">:</span> <span class="kt">List</span> <span class="kt">Bool</span> <span class="nf">-&gt;</span> <span class="kt">Html</span> <span class="nv">msg</span>
<span class="nv">row</span> <span class="nv">row</span> <span class="nf">=</span> <span class="nv">div</span> <span class="p">[</span> <span class="nv">style</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;clear&quot;</span><span class="p">,</span> <span class="s">&quot;both&quot;</span><span class="p">)</span> <span class="p">]</span> <span class="p">]</span> <span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span> <span class="nv">cell</span> <span class="nv">row</span><span class="p">)</span>

<span class="nv">cell</span> <span class="nf">:</span> <span class="kt">Bool</span> <span class="nf">-&gt;</span> <span class="kt">Html</span> <span class="nv">msg</span>
<span class="nv">cell</span> <span class="nv">on</span> <span class="nf">=</span> <span class="nv">div</span> <span class="p">[</span> <span class="nv">cellStyle</span> <span class="nv">on</span> <span class="p">]</span> <span class="p">[</span> <span class="nv">text</span> <span class="s">&quot; &quot;</span> <span class="p">]</span>

<span class="nv">cellStyle</span> <span class="nf">:</span> <span class="kt">Bool</span> <span class="nf">-&gt;</span> <span class="kt">Attribute</span> <span class="nv">msg</span>
<span class="nv">cellStyle</span> <span class="nv">on</span> <span class="nf">=</span>
  <span class="nv">style</span>
    <span class="p">[</span> <span class="p">(</span><span class="s">&quot;background&quot;</span><span class="p">,</span> <span class="kr">if</span> <span class="nv">on</span> <span class="kr">then</span> <span class="s">&quot;black&quot;</span> <span class="kr">else</span> <span class="s">&quot;white&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;width&quot;</span><span class="p">,</span> <span class="nv">toString</span> <span class="nv">cellSize</span> <span class="nf">++</span> <span class="s">&quot;px&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;height&quot;</span><span class="p">,</span> <span class="nv">toString</span> <span class="nv">cellSize</span> <span class="nf">++</span> <span class="s">&quot;px&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;float&quot;</span><span class="p">,</span> <span class="s">&quot;left&quot;</span><span class="p">)</span>
    <span class="p">]</span></code></pre></figure> <h5><a href="/examples/elm/static_grid/" target="_new">View Result <svg class="octicon octicon-link-external" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 10h1v3c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h3v1H1v10h10v-3zM6 2l2.25 2.25L5 7.5 6.5 9l3.25-3.25L12 8V2H6z"/></svg></a></h5> <p>Breaking this down, let us being with the declaration of the <code>main</code> function. This is the function that is primarily responsible for producing the output we want to render on the page. This example uses an <code>Html.beginngerProgram</code>, intended for simple programs that do not require the use of commands and subscriptions. In our particular case, we do not even need the use of the <code>update</code>, since our model is predefined and never changes, so we simply set that property to <span> <a href="http://package.elm-lang.org/packages/elm-lang/core/5.1.1/Basics#Never"><code>never</code></a> <span style="vertical-align: super"> <a href="http://package.elm-lang.org/packages/elm-lang/core/5.1.1/Basics#Never" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 10h1v3c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h3v1H1v10h10v-3zM6 2l2.25 2.25L5 7.5 6.5 9l3.25-3.25L12 8V2H6z"/></svg></a> </span> </span>, rather than supplying our own empty function.</p> <p>To elaborate on the <code>beginngerProgram</code> function somewhat, it is provided as part of the <span> <a href="http://package.elm-lang.org/packages/elm-lang/html/latest">HTML package</a> <span style="vertical-align: super"> <a href="http://package.elm-lang.org/packages/elm-lang/html/latest" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 10h1v3c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h3v1H1v10h10v-3zM6 2l2.25 2.25L5 7.5 6.5 9l3.25-3.25L12 8V2H6z"/></svg></a> </span> </span>, takes a structure with the keys <code>model</code>, <code>view</code>, and <code>update</code>. The <code>view</code> function is responsible for taking our <code>model</code> and converting it into an <code>Html msg</code>, the final markup we want to display on the page.</p> <p>In this instance, it is worthwhile to point out, we have defined a <code>type alias Grid</code> for our model. We could simply refer to our model throughout the program as the <code>List (List Bool)</code> it ultimately is, but using domain-specific aliases whenever possible is beneficial for the fluency and legibility of our code. Remember: <span> <a href="https://www.joelonsoftware.com/2000/04/06/things-you-should-never-do-part-i/">&quot;It&#39;s harder to read code than to write it.&quot;</a> <span style="vertical-align: super"> <a href="https://www.joelonsoftware.com/2000/04/06/things-you-should-never-do-part-i/" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 10h1v3c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h3v1H1v10h10v-3zM6 2l2.25 2.25L5 7.5 6.5 9l3.25-3.25L12 8V2H6z"/></svg></a> </span> </span></p> <p>Finally, we should discuss the content of our <code>model</code> and <code>view</code> functions. The former takes no arguments, and simply returns a nested list, fully populated with the value <code>True</code>. This represents a gird with every cell in an enabled state. The <code>view</code> function takes our model and, with the aid of some helper functions, produces some very simple HTML for displaying our grid. One notable aspect of these helper functions is the way in which we use a straight forward, declarative syntax for declaring something we are already familiar with.</p> <h2>Reification</h2> <p>The major difference necessary for having the ability to randomly seed our grid with cells that are either enabled or disabled is switching out main function to use the <code>Html.program</code> function. This takes a structure, much like before, but the <code>model</code> key has been substituted with the, significantly more powerful, <code>init</code> key and adds a key for <code>subscriptions</code>. While this example will not make use of the <code>subscriptions</code> key, besides setting it to <code>always Sub.none</code>, the way the <span> <a href="http://package.elm-lang.org/packages/elm-lang/core/5.1.1/Random"><code>Random</code> library</a> <span style="vertical-align: super"> <a href="http://package.elm-lang.org/packages/elm-lang/core/5.1.1/Random" target="_blank" alt="Pop Out" title="Pop Out"><svg class="octicon octicon-link-external" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 10h1v3c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h3v1H1v10h10v-3zM6 2l2.25 2.25L5 7.5 6.5 9l3.25-3.25L12 8V2H6z"/></svg></a> </span> </span> work in Elm, we must make use of commands. The resultant code follows:</p> <h4>random_grid.elm</h4> <h5>Source</h5> <figure class="highlight"><pre><code class="language-elm" data-lang="elm"><span></span><span class="kn">import </span><span class="nc">List</span>
<span class="kn">import </span><span class="nc">Random</span>

<span class="kn">import </span><span class="nc">Html</span> <span class="nv">exposing</span> <span class="p">(</span><span class="kt">Html</span><span class="p">,</span> <span class="kt">Attribute</span><span class="p">,</span> <span class="nv">div</span><span class="p">,</span> <span class="nv">text</span><span class="p">)</span>
<span class="kn">import </span><span class="nc">Html.Attributes</span> <span class="nv">exposing</span> <span class="p">(</span><span class="nv">style</span><span class="p">)</span>

<span class="kr">type</span> <span class="kr">alias</span> <span class="kt">Grid</span> <span class="nf">=</span> <span class="kt">List</span> <span class="p">(</span><span class="kt">List</span> <span class="kt">Bool</span><span class="p">)</span>
<span class="kr">type</span> <span class="kt">Msg</span> <span class="nf">=</span> <span class="kt">Initialize</span> <span class="kt">Grid</span>

<span class="nv">cellSize</span> <span class="nf">=</span> <span class="mi">5</span>
<span class="p">(</span><span class="nv">columns</span><span class="p">,</span> <span class="nv">rows</span><span class="p">)</span> <span class="nf">=</span> <span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>

<span class="kr">main </span><span class="nf">=</span>
  <span class="kt">Html</span><span class="nf">.</span><span class="nv">program</span>
    <span class="p">{</span> <span class="nv">init</span> <span class="nf">=</span> <span class="nv">init</span>
    <span class="p">,</span> <span class="nv">view</span> <span class="nf">=</span> <span class="nv">view</span>
    <span class="p">,</span> <span class="nv">update</span> <span class="nf">=</span> <span class="nv">update</span>
    <span class="p">,</span> <span class="nv">subscriptions</span> <span class="nf">=</span> <span class="nv">always</span> <span class="kt">Sub</span><span class="nf">.</span><span class="nv">none</span>
    <span class="p">}</span>

<span class="nv">init</span> <span class="nf">:</span> <span class="p">(</span><span class="kt">Grid</span><span class="p">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span><span class="p">)</span>
<span class="nv">init</span> <span class="nf">=</span>
  <span class="p">([[]],</span> <span class="kt">Random</span><span class="nf">.</span><span class="nv">generate</span>
    <span class="kt">Initialize</span>
    <span class="p">(</span><span class="kt">Random</span><span class="nf">.</span><span class="nv">map</span> <span class="p">(</span><span class="nv">groupInto</span> <span class="nv">rows</span><span class="p">)</span> <span class="p">(</span><span class="kt">Random</span><span class="nf">.</span><span class="nv">list</span> <span class="p">(</span><span class="nv">rows</span> <span class="nf">*</span> <span class="nv">columns</span><span class="p">)</span> <span class="kt">Random</span><span class="nf">.</span><span class="nv">bool</span><span class="p">)))</span>

<span class="nv">view</span> <span class="nf">:</span> <span class="kt">Grid</span> <span class="nf">-&gt;</span> <span class="kt">Html</span> <span class="nv">msg</span>
<span class="nv">view</span> <span class="nv">grid</span> <span class="nf">=</span> <span class="nv">div</span> <span class="p">[</span> <span class="p">]</span> <span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span> <span class="nv">row</span> <span class="nv">grid</span><span class="p">)</span>

<span class="nv">update</span> <span class="nf">:</span> <span class="kt">Msg</span> <span class="nf">-&gt;</span> <span class="kt">Grid</span> <span class="nf">-&gt;</span> <span class="p">(</span><span class="kt">Grid</span><span class="p">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span><span class="p">)</span>
<span class="nv">update</span> <span class="nv">msg</span> <span class="nv">_</span> <span class="nf">=</span>
  <span class="kr">case</span> <span class="nv">msg</span> <span class="kr">of</span>
    <span class="kt">Initialize</span> <span class="nv">initial</span> <span class="nf">-&gt;</span> <span class="p">(</span><span class="nv">initial</span><span class="p">,</span> <span class="kt">Cmd</span><span class="nf">.</span><span class="nv">none</span><span class="p">)</span>

<span class="nv">row</span> <span class="nf">:</span> <span class="kt">List</span> <span class="kt">Bool</span> <span class="nf">-&gt;</span> <span class="kt">Html</span> <span class="nv">msg</span>
<span class="nv">row</span> <span class="nv">row</span> <span class="nf">=</span> <span class="nv">div</span> <span class="p">[</span> <span class="nv">style</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;clear&quot;</span><span class="p">,</span> <span class="s">&quot;both&quot;</span><span class="p">)</span> <span class="p">]</span> <span class="p">]</span> <span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span> <span class="nv">cell</span> <span class="nv">row</span><span class="p">)</span>

<span class="nv">cell</span> <span class="nf">:</span> <span class="kt">Bool</span> <span class="nf">-&gt;</span> <span class="kt">Html</span> <span class="nv">msg</span>
<span class="nv">cell</span> <span class="nv">on</span> <span class="nf">=</span> <span class="nv">div</span> <span class="p">[</span> <span class="nv">cellStyle</span> <span class="nv">on</span> <span class="p">]</span> <span class="p">[</span> <span class="nv">text</span> <span class="s">&quot; &quot;</span> <span class="p">]</span>

<span class="nv">cellStyle</span> <span class="nf">:</span> <span class="kt">Bool</span> <span class="nf">-&gt;</span> <span class="kt">Attribute</span> <span class="nv">msg</span>
<span class="nv">cellStyle</span> <span class="nv">on</span> <span class="nf">=</span>
  <span class="nv">style</span>
    <span class="p">[</span> <span class="p">(</span><span class="s">&quot;background&quot;</span><span class="p">,</span> <span class="kr">if</span> <span class="nv">on</span> <span class="kr">then</span> <span class="s">&quot;black&quot;</span> <span class="kr">else</span> <span class="s">&quot;white&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;width&quot;</span><span class="p">,</span> <span class="nv">toString</span> <span class="nv">cellSize</span> <span class="nf">++</span> <span class="s">&quot;px&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;height&quot;</span><span class="p">,</span> <span class="nv">toString</span> <span class="nv">cellSize</span> <span class="nf">++</span> <span class="s">&quot;px&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;float&quot;</span><span class="p">,</span> <span class="s">&quot;left&quot;</span><span class="p">)</span>
    <span class="p">]</span>

<span class="nv">groupInto</span> <span class="nf">:</span> <span class="kt">Int</span> <span class="nf">-&gt;</span> <span class="kt">List</span> <span class="nv">a</span> <span class="nf">-&gt;</span> <span class="kt">List</span> <span class="p">(</span><span class="kt">List</span> <span class="nv">a</span><span class="p">)</span>
<span class="nv">groupInto</span> <span class="nv">n</span> <span class="nv">lst</span> <span class="nf">=</span>
  <span class="kr">if</span> <span class="kt">List</span><span class="nf">.</span><span class="nv">length</span> <span class="nv">lst</span> <span class="nf">==</span> <span class="mi">0</span> <span class="kr">then</span>
    <span class="p">[]</span>
  <span class="kr">else</span>
    <span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">take</span> <span class="nv">n</span> <span class="nv">lst</span><span class="p">)</span> <span class="nf">::</span> <span class="p">(</span><span class="nv">groupInto</span> <span class="nv">n</span> <span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">drop</span> <span class="nv">n</span> <span class="nv">lst</span><span class="p">))</span></code></pre></figure> <h5><a href="/examples/elm/random_grid/" target="_new">View Result <svg class="octicon octicon-link-external" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 10h1v3c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h3v1H1v10h10v-3zM6 2l2.25 2.25L5 7.5 6.5 9l3.25-3.25L12 8V2H6z"/></svg></a></h5> <p>To expand upon the need for the full-fledged <code>Html.program</code> in this example, it is necessary to understand the interplay between the <code>init</code> and <code>update</code> functions, with the <code>Cmd Msg</code> being, passed between them in light of how random number generation works. Let us begin with that elucidation. Since random values must be generated at runtime, it is not possible to define a model with random values in the same way we created a static one in the first example. As such, we statically define our generator, and the <code>Random.generate</code> call inside the <code>init</code> function creates a <code>Cmd</code> we can later respond to.</p> <p>This command is of type <code>Msg</code>, which only contains one possible value, <code>Initialize Grid</code>. When the <code>init</code> method returns, the existence of this command will cause the <code>update</code> method to be called, in this case with our <code>Msg Grid</code>, where the grid is fully populated with randomly generated values. The first argument to the <code>update</code> function is the current version of the model, as kept track of by Elm, in this, the first item in the tuple returned by the <code>init</code> function.</p> <p>Since the <code>update</code> function returns with a <code>Cmd.none</code> as the second part of its tuple, after having pulled the initial grid from its message, and there are no further subscriptions, the program ends after one iteration of <code>update</code>.</p> <h2>Recurrence</h2> <p>Finally, we have advanced to a point where adding generations is trivial. This requires only three, fairly straightforward, changes:</p> <ol> <li>Add a <code>Tick Time</code> value to our <code>Msg</code> type.</li> <li>Respond to the <code>Tick</code> message in our <code>update</code> function.</li> <li>Define <code>subscriptions</code> creates <code>Tick</code> messages.</li> </ol> <p>The <code>subscriptions</code> function ignores the <code>Grid</code> passed to it, since the passage of time cares not about the current state of our simulation, and just emits a new <code>Tick</code> message every second. This is, in fact, perfectly legible from the code itself, so I will let it speak for itself.</p> <h4>game_of_life.elm</h4> <h5>Source</h5> <figure class="highlight"><pre><code class="language-elm" data-lang="elm"><span></span><span class="kn">import </span><span class="nc">List</span>
<span class="kn">import </span><span class="nc">Random</span>
<span class="kn">import </span><span class="nc">Time</span> <span class="nv">exposing</span> <span class="p">(</span><span class="kt">Time</span><span class="p">)</span>
<span class="kn">import </span><span class="nc">Tuple</span> <span class="nv">exposing</span> <span class="p">(</span><span class="nv">first</span><span class="p">,</span> <span class="nv">second</span><span class="p">)</span>

<span class="kn">import </span><span class="nc">Html</span> <span class="nv">exposing</span> <span class="p">(</span><span class="kt">Html</span><span class="p">,</span> <span class="kt">Attribute</span><span class="p">,</span> <span class="nv">div</span><span class="p">,</span> <span class="nv">text</span><span class="p">)</span>
<span class="kn">import </span><span class="nc">Html.Attributes</span> <span class="nv">exposing</span> <span class="p">(</span><span class="nv">style</span><span class="p">)</span>

<span class="kr">type</span> <span class="kr">alias</span> <span class="kt">Grid</span> <span class="nf">=</span> <span class="kt">List</span> <span class="p">(</span><span class="kt">List</span> <span class="kt">Bool</span><span class="p">)</span>
<span class="kr">type</span> <span class="kt">Msg</span> <span class="nf">=</span> <span class="kt">Initialize</span> <span class="kt">Grid</span> <span class="nf">|</span> <span class="kt">Tick</span> <span class="kt">Time</span>

<span class="nv">cellSize</span> <span class="nf">=</span> <span class="mi">5</span>
<span class="p">(</span><span class="nv">columns</span><span class="p">,</span> <span class="nv">rows</span><span class="p">)</span> <span class="nf">=</span> <span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>

<span class="kr">main </span><span class="nf">=</span>
  <span class="kt">Html</span><span class="nf">.</span><span class="nv">program</span>
    <span class="p">{</span> <span class="nv">init</span> <span class="nf">=</span> <span class="nv">init</span>
    <span class="p">,</span> <span class="nv">view</span> <span class="nf">=</span> <span class="nv">view</span>
    <span class="p">,</span> <span class="nv">update</span> <span class="nf">=</span> <span class="nv">update</span>
    <span class="p">,</span> <span class="nv">subscriptions</span> <span class="nf">=</span> <span class="nv">subscriptions</span>
    <span class="p">}</span>

<span class="nv">init</span> <span class="nf">:</span> <span class="p">(</span><span class="kt">Grid</span><span class="p">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span><span class="p">)</span>
<span class="nv">init</span> <span class="nf">=</span>
  <span class="p">([[]],</span> <span class="kt">Random</span><span class="nf">.</span><span class="nv">generate</span>
    <span class="kt">Initialize</span>
    <span class="p">(</span><span class="kt">Random</span><span class="nf">.</span><span class="nv">map</span> <span class="p">(</span><span class="nv">groupInto</span> <span class="nv">columns</span><span class="p">)</span> <span class="p">(</span><span class="kt">Random</span><span class="nf">.</span><span class="nv">list</span> <span class="p">(</span><span class="nv">rows</span> <span class="nf">*</span> <span class="nv">columns</span><span class="p">)</span> <span class="kt">Random</span><span class="nf">.</span><span class="nv">bool</span><span class="p">)))</span>

<span class="nv">view</span> <span class="nf">:</span> <span class="kt">Grid</span> <span class="nf">-&gt;</span> <span class="kt">Html</span> <span class="nv">msg</span>
<span class="nv">view</span> <span class="nv">grid</span> <span class="nf">=</span> <span class="nv">div</span> <span class="p">[</span> <span class="p">]</span> <span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span> <span class="nv">row</span> <span class="nv">grid</span><span class="p">)</span>

<span class="nv">update</span> <span class="nf">:</span> <span class="kt">Msg</span> <span class="nf">-&gt;</span> <span class="kt">Grid</span> <span class="nf">-&gt;</span> <span class="p">(</span><span class="kt">Grid</span><span class="p">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span><span class="p">)</span>
<span class="nv">update</span> <span class="nv">msg</span> <span class="nv">state</span> <span class="nf">=</span>
  <span class="kr">case</span> <span class="nv">msg</span> <span class="kr">of</span>
    <span class="kt">Initialize</span> <span class="nv">initial</span> <span class="nf">-&gt;</span> <span class="p">(</span><span class="nv">initial</span><span class="p">,</span> <span class="kt">Cmd</span><span class="nf">.</span><span class="nv">none</span><span class="p">)</span>

    <span class="kt">Tick</span> <span class="nv">_</span> <span class="nf">-&gt;</span> <span class="p">(</span><span class="nv">evolve</span> <span class="nv">state</span><span class="p">,</span> <span class="kt">Cmd</span><span class="nf">.</span><span class="nv">none</span><span class="p">)</span>

<span class="nv">subscriptions</span> <span class="nf">:</span> <span class="kt">Grid</span> <span class="nf">-&gt;</span> <span class="kt">Sub</span> <span class="kt">Msg</span>
<span class="nv">subscriptions</span> <span class="nv">_</span> <span class="nf">=</span> <span class="kt">Time</span><span class="nf">.</span><span class="nv">every</span> <span class="kt">Time</span><span class="nf">.</span><span class="nv">second</span> <span class="kt">Tick</span>

<span class="nv">row</span> <span class="nf">:</span> <span class="kt">List</span> <span class="kt">Bool</span> <span class="nf">-&gt;</span> <span class="kt">Html</span> <span class="nv">msg</span>
<span class="nv">row</span> <span class="nv">row</span> <span class="nf">=</span> <span class="nv">div</span> <span class="p">[</span> <span class="nv">style</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;clear&quot;</span><span class="p">,</span> <span class="s">&quot;both&quot;</span><span class="p">)</span> <span class="p">]</span> <span class="p">]</span> <span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">map</span> <span class="nv">cell</span> <span class="nv">row</span><span class="p">)</span>

<span class="nv">cell</span> <span class="nf">:</span> <span class="kt">Bool</span> <span class="nf">-&gt;</span> <span class="kt">Html</span> <span class="nv">msg</span>
<span class="nv">cell</span> <span class="nv">on</span> <span class="nf">=</span> <span class="nv">div</span> <span class="p">[</span> <span class="nv">cellStyle</span> <span class="nv">on</span> <span class="p">]</span> <span class="p">[</span> <span class="nv">text</span> <span class="s">&quot; &quot;</span> <span class="p">]</span>

<span class="nv">cellStyle</span> <span class="nf">:</span> <span class="kt">Bool</span> <span class="nf">-&gt;</span> <span class="kt">Attribute</span> <span class="nv">msg</span>
<span class="nv">cellStyle</span> <span class="nv">on</span> <span class="nf">=</span>
  <span class="nv">style</span>
    <span class="p">[</span> <span class="p">(</span><span class="s">&quot;background&quot;</span><span class="p">,</span> <span class="kr">if</span> <span class="nv">on</span> <span class="kr">then</span> <span class="s">&quot;black&quot;</span> <span class="kr">else</span> <span class="s">&quot;white&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;width&quot;</span><span class="p">,</span> <span class="nv">toString</span> <span class="nv">cellSize</span> <span class="nf">++</span> <span class="s">&quot;px&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;height&quot;</span><span class="p">,</span> <span class="nv">toString</span> <span class="nv">cellSize</span> <span class="nf">++</span> <span class="s">&quot;px&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;float&quot;</span><span class="p">,</span> <span class="s">&quot;left&quot;</span><span class="p">)</span>
    <span class="p">]</span>

<span class="nv">groupInto</span> <span class="nf">:</span> <span class="kt">Int</span> <span class="nf">-&gt;</span> <span class="kt">List</span> <span class="nv">a</span> <span class="nf">-&gt;</span> <span class="kt">List</span> <span class="p">(</span><span class="kt">List</span> <span class="nv">a</span><span class="p">)</span>
<span class="nv">groupInto</span> <span class="nv">n</span> <span class="nv">lst</span> <span class="nf">=</span>
  <span class="kr">if</span> <span class="kt">List</span><span class="nf">.</span><span class="nv">length</span> <span class="nv">lst</span> <span class="nf">==</span> <span class="mi">0</span> <span class="kr">then</span>
    <span class="p">[]</span>
  <span class="kr">else</span>
    <span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">take</span> <span class="nv">n</span> <span class="nv">lst</span><span class="p">)</span> <span class="nf">::</span> <span class="p">(</span><span class="nv">groupInto</span> <span class="nv">n</span> <span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">drop</span> <span class="nv">n</span> <span class="nv">lst</span><span class="p">))</span>

<span class="nv">evolve</span> <span class="nf">:</span> <span class="kt">Grid</span> <span class="nf">-&gt;</span> <span class="kt">Grid</span>
<span class="nv">evolve</span> <span class="nv">generation</span> <span class="nf">=</span>
  <span class="kt">List</span><span class="nf">.</span><span class="nv">indexedMap</span> <span class="p">(</span><span class="nf">\</span><span class="nv">y</span> <span class="nv">row</span> <span class="nf">-&gt;</span>
    <span class="kt">List</span><span class="nf">.</span><span class="nv">indexedMap</span> <span class="p">(</span><span class="nf">\</span><span class="nv">x</span> <span class="nv">_</span> <span class="nf">-&gt;</span>
      <span class="nv">descend</span> <span class="nv">generation</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="nv">row</span><span class="p">)</span> <span class="nv">generation</span>

<span class="nv">descend</span> <span class="nf">:</span> <span class="kt">Grid</span> <span class="nf">-&gt;</span> <span class="kt">Int</span> <span class="nf">-&gt;</span> <span class="kt">Int</span> <span class="nf">-&gt;</span> <span class="kt">Bool</span>
<span class="nv">descend</span> <span class="nv">grid</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nf">=</span>
  <span class="kt">List</span><span class="nf">.</span><span class="nv">concatMap</span> <span class="p">(</span><span class="nf">\</span><span class="nv">n</span> <span class="nf">-&gt;</span> <span class="kt">List</span><span class="nf">.</span><span class="nv">map</span> <span class="p">(</span><span class="nf">\</span><span class="nv">m</span> <span class="nf">-&gt;</span> <span class="p">(</span><span class="nv">x</span> <span class="nf">+</span> <span class="nv">n</span><span class="p">,</span> <span class="nv">y</span> <span class="nf">+</span> <span class="nv">m</span><span class="p">))</span>
                   <span class="p">[</span><span class="nf">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="p">[</span><span class="nf">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="nf">|&gt;</span> <span class="kt">List</span><span class="nf">.</span><span class="nv">filter</span> <span class="p">(</span><span class="nf">\</span><span class="nv">p</span> <span class="nf">-&gt;</span> <span class="p">(</span><span class="nv">first</span> <span class="nv">p</span><span class="p">)</span> <span class="nf">&gt;</span> <span class="nf">-</span><span class="mi">1</span> <span class="nf">&amp;&amp;</span> <span class="p">(</span><span class="nv">first</span> <span class="nv">p</span><span class="p">)</span> <span class="nf">&lt;</span> <span class="nv">columns</span> <span class="nf">&amp;&amp;</span>
                          <span class="p">(</span><span class="nv">second</span> <span class="nv">p</span><span class="p">)</span> <span class="nf">&gt;</span> <span class="nf">-</span><span class="mi">1</span> <span class="nf">&amp;&amp;</span> <span class="p">(</span><span class="nv">second</span> <span class="nv">p</span><span class="p">)</span> <span class="nf">&lt;</span> <span class="nv">rows</span> <span class="nf">&amp;&amp;</span>
                          <span class="p">(</span><span class="nv">not</span> <span class="p">((</span><span class="nv">first</span> <span class="nv">p</span><span class="p">)</span> <span class="nf">==</span> <span class="nv">x</span> <span class="nf">&amp;&amp;</span> <span class="p">(</span><span class="nv">second</span> <span class="nv">p</span><span class="p">)</span> <span class="nf">==</span> <span class="nv">y</span><span class="p">)))</span>
    <span class="nf">|&gt;</span> <span class="kt">List</span><span class="nf">.</span><span class="nv">filter</span> <span class="p">(</span><span class="nf">\</span><span class="nv">p</span> <span class="nf">-&gt;</span> <span class="p">(</span><span class="nv">valueAt</span> <span class="p">(</span><span class="nv">first</span> <span class="nv">p</span><span class="p">)</span> <span class="kt">False</span>
                            <span class="p">(</span><span class="nv">valueAt</span> <span class="p">(</span><span class="nv">second</span> <span class="nv">p</span><span class="p">)</span> <span class="p">[]</span> <span class="nv">grid</span><span class="p">)))</span>
    <span class="nf">|&gt;</span> <span class="kt">List</span><span class="nf">.</span><span class="nv">length</span>
    <span class="nf">|&gt;</span> <span class="p">(</span><span class="nf">\</span><span class="nv">l</span> <span class="nf">-&gt;</span> <span class="p">((</span><span class="nv">valueAt</span> <span class="nv">x</span> <span class="kt">False</span> <span class="p">(</span><span class="nv">valueAt</span> <span class="nv">y</span> <span class="p">[]</span> <span class="nv">grid</span><span class="p">))</span>
                <span class="nf">&amp;&amp;</span> <span class="nv">l</span> <span class="nf">&gt;</span> <span class="mi">1</span> <span class="nf">&amp;&amp;</span> <span class="nv">l</span> <span class="nf">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="nf">||</span> <span class="nv">l</span> <span class="nf">==</span> <span class="mi">3</span><span class="p">)</span>

<span class="nv">valueAt</span> <span class="nf">:</span> <span class="kt">Int</span> <span class="nf">-&gt;</span> <span class="nv">a</span> <span class="nf">-&gt;</span> <span class="kt">List</span> <span class="nv">a</span> <span class="nf">-&gt;</span> <span class="nv">a</span>
<span class="nv">valueAt</span> <span class="nv">i</span> <span class="nv">default</span> <span class="nv">lst</span> <span class="nf">=</span>
  <span class="kt">Maybe</span><span class="nf">.</span><span class="nv">withDefault</span> <span class="nv">default</span> <span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">head</span> <span class="p">(</span><span class="kt">List</span><span class="nf">.</span><span class="nv">drop</span> <span class="nv">i</span> <span class="nv">lst</span><span class="p">))</span></code></pre></figure> <h5><a href="/examples/elm/game_of_life/" target="_new">View Result <svg class="octicon octicon-link-external" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11 10h1v3c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h3v1H1v10h10v-3zM6 2l2.25 2.25L5 7.5 6.5 9l3.25-3.25L12 8V2H6z"/></svg></a></h5> <h2>Resolution</h2> <p>As you can see in the final example, most of the changes are in support of updating the state of the grid, not for wiring those updates themselves; that part was trivial. The ease of adding new paths, without interfering with existing ones, is, I believe, one of the major improvements of the language. In the past, I always felt as though I were building some <code>foldp</code> monstrosity, even though it could be decomposed into separate parts that acted similar in the ability to constrain changes. Today, the pattern is explicit in the structure of the program, making it apparent even to new users.</p> <p>While it may be more cumbersome in larger programs to have so few points of contact with the inner mechanisms that control dynamic elements, I can at least conceptualize ways in which components can be combined to ameliorate this potential issue. In contrast, trying to expose signals from modules and hook them together with channels felt very kludgey and limited at times.</p> <p>Another key change is that Elm has become renderer agnostic. In these examples, I used the official HTML package, but I could have chosen SVG or the old Graphics packages if I preferred. In the past, I always found this a confusing aspect of the platform. Now that HTML is supported in this way, there is no longer any need to explain to new users about the graphics libraries, again, making it much easier for new users to get on boards.</p> <p>I am, ultimately, happy I stepped away and let the language mature for some time. Also included in the versions are numerous enhancements, particularly in the realms of tooling and error messages. With the conceptual core conceivably cemented, and future improvements aimed primarily at improving user experience, if you have been reluctant to give Elm a try, I wholeheartedly recommend giving it a try today.</p> <span class="post-date">22 May 2017</span> </div> <div class="related"> <h2>Related Posts</h2> <ul class="related-posts"> <li> <h3> <a href="/2017/06/18/on-maintainability-gold-plating-the-game-of-life-in-elm/"> On Maintainability: Gold Plating the Game of Life in Elm <small>18 Jun 2017</small> </a> </h3> </li> <li> <h3> <a href="/2014/05/05/writing-game-of-life-in-elm/"> Writing Game of Life in Elm <small>05 May 2014</small> </a> </h3> </li> <li> <h3> <a href="/2017/06/05/common-table-expressions-in-activerecord-a-case-study-of-quantiles/"> Common Table Expressions in ActiveRecord: A Case Study of Quantiles <small>05 Jun 2017</small> </a> </h3> </li> </ul> </div> <p class="bitcoin"></p> </div> <script>!function(e,n,t,a,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=n.createElement(t),s=n.getElementsByTagName(t)[0],o.async=1,o.src=a,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-47296801-1","sonnym.github.io"),ga("send","pageview");</script> </body> </html>